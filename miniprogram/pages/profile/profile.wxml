<!-- profile.wxml -->
<view class="container">
  <!-- 用户信息 -->
  <view class="user-card">
    <image src="{{userInfo.avatar}}" class="avatar"></image>
    <view class="user-info">
      <text class="name">{{userInfo.name}}</text>
      <text class="title">{{userInfo.title}}</text>
    </view>
    <view class="stats">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalBookings}}</text>
        <text class="stat-label">总预约</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.upcoming}}</text>
        <text class="stat-label">即将进行</text>
      </view>
    </view>
  </view>
  
  <!-- 月份导航 -->
  <view class="month-navigation">
    <image src="/images/arrow-left.png" class="nav-arrow" bindtap="prevMonth"></image>
    <text class="month-title">{{currentMonth}}</text>
    <image src="/images/arrow-right.png" class="nav-arrow" bindtap="nextMonth"></image>
  </view>
  
 <!-- 日历容器（统一网格布局） -->
 <view class="calendar-container">
    <!-- 星期标题（使用网格布局） -->
    <view class="week-header">
      <view wx:for="{{weekDays}}" wx:key="index" class="week-day">
        {{item}}
      </view>
    </view>
    
    <!-- 日历区域（使用网格布局） -->
    <view class="calendar-grid">
      <view wx:for="{{calendarDays}}" wx:key="index" class="calendar-cell {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}} {{item.hasEvent ? 'has-event' : ''}} {{item.isCurrentMonth ? '' : 'other-month'}}"
            bindtap="selectDate" data-date="{{item.date}}">
        <text class="day-number">{{item.day}}</text>
        <view wx:if="{{item.hasEvent}}" class="event-indicator"></view>
      </view>
    </view>
  </view>
  
  <!-- 查看当日详情按钮 -->
  <view class="view-detail-btn">
  <view class="detail-btn" bindtap="viewDayDetail">
    <view class="btn-content">
      <text class="date-text">{{formattedSelectedDate}}</text>
      <text class="btn-text">详情</text>
    </view>
  </view>
</view>
  
  <!-- 即将进行的任务 -->
<view class="section">
  <view class="section-header">
    <text class="section-title">即将进行的任务</text>
    <text class="section-more" bindtap="viewAllBookings">查看全部 ></text>
  </view>

  <!-- 单个任务卡片 -->
  <view class="task-container" wx:if="{{upcomingTask}}">
     <!-- 任务状态 - 移动到卡片顶部 -->
     <view class="task-status {{upcomingTask.status}}">
      <text>{{upcomingTask.status === 'confirmed' ? '已确认' : '待确认'}}</text>
      <text class="countdown" wx:if="{{upcomingTask.status === 'confirmed'}}">
        倒计时: {{upcomingTask.countdown}}
      </text>
    </view>

    <view class="task-card">
      <!-- 任务时间 -->
      <view class="task-time">
        <text class="task-date">{{upcomingTask.date}}</text>
        <text class="task-weekday">{{upcomingTask.day}}</text>
        <text class="task-duration">{{upcomingTask.time}}</text>
      </view>
      
      <!-- 任务内容 -->
      <view class="task-content">
        <text class="task-title">{{upcomingTask.topic}}</text>
        <view class="task-info">
          <image src="/images/user-icon.png" class="task-icon"></image>
          <text class="task-detail">与 {{upcomingTask.with}}</text>
        </view>
        <view class="task-info">
          <image src="/images/location-icon.png" class="task-icon"></image>
          <text class="task-detail">地点: {{upcomingTask.location || '线上会议'}}</text>
        </view>
      </view>
      
      <!-- 任务操作 -->
      <view class="task-actions">
        <button class="action-btn" bindtap="contactUser">
          <image src="/images/contact-icon.png" class="action-icon"></image>
          <text>联系</text>
        </button>
        <button class="action-btn" bindtap="modifyTask">
          <image src="/images/edit-icon.png" class="action-icon"></image>
          <text>修改</text>
        </button>
        <button class="action-btn cancel-btn" bindtap="cancelTask">
          <image src="/images/cancel-icon.png" class="action-icon"></image>
          <text>取消</text>
        </button>
      </view>
    </view>
    
    <!-- 任务进度 -->
    <view class="task-progress">
      <progress 
        percent="{{upcomingTask.progress}}" 
        activeColor="#52c41a" 
        backgroundColor="#f0f0f0" 
        stroke-width="8" 
        active
      />
      <text class="progress-text">准备中: {{upcomingTask.progress}}%</text>
    </view>
  </view>
  
  <!-- 空状态 -->
  <view class="empty-tasks" wx:else>
    <image src="/images/no-tasks.png" class="empty-image"></image>
    <text class="empty-text">当前没有即将进行的任务</text>
    <text class="empty-tip">添加新任务或查看全部任务</text>
  </view>
</view>

</view>